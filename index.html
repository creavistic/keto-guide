<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Keto & Fasting Coach</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#0ea5e9" />
  <!-- Icono simple desde CDN (opcional, luego puedes subir tus PNG) -->
  <link rel="apple-touch-icon" href="https://via.placeholder.com/192.png?text=Keto" />

  <!-- Tailwind (estilos) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="app" class="max-w-4xl mx-auto p-4 md:p-8"></div>

  <!-- React UMD + Babel (sin build) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;
    const fmt = (n) => (Number.isFinite(n) ? n.toFixed(1) : "0.0");
    const save = (k,v)=>localStorage.setItem(k, JSON.stringify(v));
    const load = (k,d)=>{ try{ const v = JSON.parse(localStorage.getItem(k)); return v ?? d;} catch{ return d; } };

    const FOODS = [
      { cat:"Carnes y aves", name:"Pechuga de pollo", p:31, c:0, f:3.6 },
      { cat:"Carnes y aves", name:"Muslo de pollo c/ piel", p:24, c:0, f:8 },
      { cat:"Carnes y aves", name:"Ternera magra", p:26, c:0, f:10 },
      { cat:"Carnes y aves", name:"Cerdo lomo", p:27, c:0, f:12 },
      { cat:"Carnes y aves", name:"Bacon", p:37, c:1.4, f:42 },
      { cat:"Pescados y mariscos", name:"Salm√≥n fresco", p:20, c:0, f:13 },
      { cat:"Pescados y mariscos", name:"At√∫n fresco", p:23, c:0, f:1 },
      { cat:"Pescados y mariscos", name:"Sardinas", p:25, c:0, f:11 },
      { cat:"Pescados y mariscos", name:"Gambas", p:24, c:0.2, f:0.3 },
      { cat:"Verduras", name:"Espinacas", p:2.9, c:1.4, f:0.4 },
      { cat:"Verduras", name:"Br√≥coli", p:2.8, c:4, f:0.4 },
      { cat:"Verduras", name:"Calabac√≠n", p:1.2, c:2.1, f:0.3 },
      { cat:"Verduras", name:"Coliflor", p:1.9, c:3, f:0.3 },
      { cat:"Verduras", name:"Pepino", p:0.7, c:3, f:0.1 },
      { cat:"Frutas bajas", name:"Aguacate", p:2, c:1.8, f:15 },
      { cat:"Frutas bajas", name:"Fresas", p:0.8, c:5.5, f:0.3 },
      { cat:"Frutos secos", name:"Almendras", p:21, c:9, f:49 },
      { cat:"Frutos secos", name:"Nueces", p:15, c:7, f:65 },
      { cat:"Grasas y l√°cteos", name:"Aceite de oliva", p:0, c:0, f:100 },
      { cat:"Grasas y l√°cteos", name:"Aceite de coco", p:0, c:0, f:100 },
      { cat:"Grasas y l√°cteos", name:"Mantequilla", p:0.9, c:0, f:81 },
      { cat:"Grasas y l√°cteos", name:"Queso cheddar", p:25, c:1.3, f:33 },
      { cat:"Grasas y l√°cteos", name:"Queso parmesano", p:35, c:4, f:28 },
      { cat:"Grasas y l√°cteos", name:"Queso crema", p:6, c:4, f:34 },
    ];

    function Stat({ label, value, suffix }) {
      return (
        <div className="rounded-2xl shadow-sm border bg-white">
          <div className="p-4">
            <div className="text-xs text-slate-500">{label}</div>
            <div className="text-xl font-semibold">{value}{suffix}</div>
          </div>
        </div>
      );
    }

    function FastingTimer() {
      const [start, setStart] = useState(load("fasting_start", null));
      const [target, setTarget] = useState(load("fasting_target", 16));
      const [now, setNow] = useState(Date.now());
      useEffect(()=>{ const t=setInterval(()=>setNow(Date.now()),1000); return ()=>clearInterval(t); },[]);
      useEffect(()=>save("fasting_start", start),[start]);
      useEffect(()=>save("fasting_target", target),[target]);
      const elapsedH = useMemo(()=> (start ? (now - start)/3600000 : 0), [start, now]);
      const pct = Math.min(100, elapsedH/target*100);
      const stage = useMemo(()=>{
        if(!start) return "No iniciado";
        if(elapsedH<4) return "Absorci√≥n (0‚Äì4 h)";
        if(elapsedH<12) return "Postabsorci√≥n (4‚Äì12 h)";
        if(elapsedH<16) return "Gluc√≥geno ‚Üì (12‚Äì16 h)";
        if(elapsedH<24) return "Inicio cetog√©nesis (16‚Äì24 h)";
        if(elapsedH<48) return "Cetosis ligera (24‚Äì48 h)";
        if(elapsedH<72) return "Cetosis profunda (48‚Äì72 h)";
        return "Adaptaci√≥n (>72 h)";
      },[elapsedH,start]);

      return (
        <div className="rounded-2xl border bg-white">
          <div className="p-4 border-b"><div className="text-lg font-semibold">‚è±Ô∏è Ayuno en curso</div></div>
          <div className="p-4 space-y-4">
            <div className="flex items-center gap-3">
              <button onClick={()=>setStart(Date.now())} className="px-3 py-2 rounded-2xl bg-sky-600 text-white">Iniciar</button>
              <button onClick={()=>setStart(null)} className="px-3 py-2 rounded-2xl bg-slate-200">Reiniciar</button>
              <div className="ml-auto w-44 text-xs">
                <div className="text-slate-500">Objetivo (horas): {target}</div>
                <input type="range" min="8" max="72" step="1" value={target} onChange={(e)=>setTarget(parseInt(e.target.value))} className="w-full"/>
              </div>
            </div>
            <div className="w-full h-3 bg-slate-200 rounded-full overflow-hidden">
              <div className="h-full bg-sky-500" style={{width: pct+"%"}}></div>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
              <Stat label="Horas" value={fmt(elapsedH)} suffix=" h"/>
              <Stat label="Progreso" value={fmt(pct)} suffix="%"/>
              <Stat label="Etapa" value={stage} suffix=""/>
              <Stat label="Recomendaci√≥n" value={elapsedH<24? "Cardio ligero":"Fuerza moderada"} suffix=""/>
            </div>
          </div>
        </div>
      );
    }

    function MacroRow({ item, onAdd }) {
      const [g,setG] = useState(100);
      const p = (item.p*g)/100, c=(item.c*g)/100, f=(item.f*g)/100;
      return (
        <div className="grid grid-cols-12 items-center gap-2 py-2 border-b">
          <div className="col-span-4">
            <div className="font-medium">{item.name}</div>
            <div className="text-xs text-slate-500">{item.cat}</div>
          </div>
          <div className="col-span-3 text-xs"><span className="mr-2">P {fmt(p)}g</span><span className="mr-2">C {fmt(c)}g</span><span>G {fmt(f)}g</span></div>
          <div className="col-span-3 flex items-center gap-2">
            <input type="number" className="h-8 border rounded px-2 w-full" value={g} onChange={(e)=>setG(parseInt(e.target.value||"0"))}/>
            <span className="text-xs text-slate-500">g</span>
          </div>
          <div className="col-span-2 text-right">
            <button onClick={()=>onAdd(item,g)} className="px-3 py-1 rounded-xl bg-emerald-600 text-white">A√±adir</button>
          </div>
        </div>
      );
    }

    function MealPlanner(){
      const [items,setItems] = useState(load("meal_items",[]));
      useEffect(()=>save("meal_items",items),[items]);
      const add = (it,g)=>setItems([...items,{name:it.name,cat:it.cat,g, p:(it.p*g)/100, c:(it.c*g)/100, f:(it.f*g)/100}]);
      const del = (i)=>setItems(items.filter((_,x)=>x!==i));
      const totals = items.reduce((a,x)=>({p:a.p+x.p, c:a.c+x.c, f:a.f+x.f, g:a.g+x.g}), {p:0,c:0,f:0,g:0});
      return (
        <div className="grid gap-4 md:grid-cols-5">
          <div className="md:col-span-3 rounded-2xl border bg-white">
            <div className="p-4 border-b"><div className="text-lg font-semibold">üçè Alimentos keto (por 100 g)</div></div>
            <div className="p-4">{FOODS.map((it,i)=><MacroRow key={i} item={it} onAdd={add}/>)}</div>
          </div>
          <div className="md:col-span-2 space-y-4">
            <div className="rounded-2xl border bg-white">
              <div className="p-4 border-b"><div className="text-lg font-semibold">üî• Tu comida de hoy</div></div>
              <div className="p-4 space-y-3">
                <div className="rounded-xl border divide-y">
                  {items.length===0 && <div className="p-4 text-sm text-slate-500">A√±ade alimentos desde la izquierda.</div>}
                  {items.map((x,i)=> (
                    <div key={i} className="p-3 grid grid-cols-12 gap-2 items-center">
                      <div className="col-span-6">
                        <div className="font-medium">{x.name}</div>
                        <div className="text-xs text-slate-500">{fmt(x.g)} g ¬∑ {x.cat}</div>
                      </div>
                      <div className="col-span-5 text-xs"><span className="mr-2">P {fmt(x.p)}g</span><span className="mr-2">C {fmt(x.c)}g</span><span>G {fmt(x.f)}g</span></div>
                      <div className="col-span-1 text-right"><button className="text-slate-500" onClick={()=>del(i)}>üóëÔ∏è</button></div>
                    </div>
                  ))}
                </div>
                <div className="rounded-2xl bg-slate-100 p-3">
                  <div className="text-xs text-slate-500">Totales</div>
                  <div className="flex items-center justify-between">
                    <div className="text-xs"><span className="mr-2">P {fmt(totals.p)}g</span><span className="mr-2">C {fmt(totals.c)}g</span><span>G {fmt(totals.f)}g</span></div>
                    <div className="text-xs">{fmt(totals.g)} g</div>
                  </div>
                </div>
              </div>
            </div>

            <div className="rounded-2xl border bg-white">
              <div className="p-4 border-b"><div className="text-lg font-semibold">Etapas del ayuno</div></div>
              <div className="p-4 grid md:grid-cols-3 gap-3 text-sm">
                {[
                  {h:"0‚Äì4 h", t:"Absorci√≥n", d:"Glucosa de la comida; insulina alta."},
                  {h:"4‚Äì12 h", t:"Postabsorci√≥n", d:"Gluc√≥geno hep√°tico; insulina ‚Üì, glucag√≥n ‚Üë."},
                  {h:"12‚Äì16 h", t:"Gluc√≥geno‚Üì", d:"Lip√≥lisis inicial; grasas en aumento."},
                  {h:"16‚Äì24 h", t:"Cetog√©nesis", d:"Gluconeog√©nesis y cetonas iniciales."},
                  {h:"24‚Äì48 h", t:"Cetosis ligera", d:"Cetonas suben; energ√≠a estable."},
                  {h:"48‚Äì72 h", t:"Cetosis profunda", d:"Autofagia activa; preservaci√≥n muscular."},
                  {h:">72 h", t:"Adaptaci√≥n", d:"Cetonas dominan; gluconeog√©nesis m√≠nima."}
                ].map((x,i)=>(
                  <div key={i} className="rounded-xl border p-3">
                    <div className="font-semibold">{x.t} <span className="text-xs text-slate-500">{x.h}</span></div>
                    <div className="text-slate-500 mt-1">{x.d}</div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    function App(){
      const [tab,setTab] = useState("ayuno");
      return (
        <div className="min-h-screen max-w-4xl mx-auto p-4 md:p-8">
          <header className="mb-4">
            <h1 className="text-2xl md:text-3xl font-bold tracking-tight">Keto & Fasting Coach</h1>
            <p className="text-sm text-slate-500">Planifica tu ayuno, comidas keto y entrenos.</p>
          </header>
          <div className="rounded-2xl bg-white border mb-3 p-1 inline-flex">
            {["ayuno","comidas","guia"].map(t=>(
              <button key={t} onClick={()=>setTab(t)} className={"px-4 py-2 rounded-xl "+(tab===t?"bg-slate-900 text-white":"")}>
                {t==="ayuno"?"Ayuno":t==="comidas"?"Comidas":"Gu√≠a"}
              </button>
            ))}
          </div>
          {tab==="ayuno" && <FastingTimer/>}
          {tab==="comidas" && <MealPlanner/>}
          {tab==="guia" && <div className="text-sm text-slate-500">Inst√°lala desde el navegador para usarla como app (PWA).</div>}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("app")).render(<App/>);

    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => navigator.serviceWorker.register("./sw.js"));
    }
  </script>
</body>
</html>
